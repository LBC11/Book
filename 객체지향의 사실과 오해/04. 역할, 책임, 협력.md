# 04. 역할, 책임, 협력

최후 통첩 게임에서 알 수 있듯이 인간의 행동 방식을 결정하는 것은 바로 각 개인이 처해 있는 정황 또는 **문맥(context)** 이다. 이와 똑같이 객체지향에서 객체의 행동을 결정하는 것은 바로 객체들 사이에 이뤄지는 **협력**이다. 

결론적으로 객체가 사이의 **협력**이 객체의 **행동**을 결정하고 행동이 객체의 **상태** 를 결정한다.

## 1. 협력

**협력**은 다수의 요청과 응답으로 구성되며 전체적으로 협력은 다수의 연쇄적인 요청과 응답의 흐름으로 구성된다.

예시

1. a는 b가 재판을 시작하라고 요청함
2. 요청받은 b는 c에게 d가 입장하라고 요청한다.
3. 요청받은 c는 d에게 입장하라고 요청한다.
4. d는 입장함으로써 c에게 응답한다.
5. d의 입장은 b가 c에게 했던 요청에 대한 응답이기도 하다.
6. b는 d에게 증언하라고 요청한다.
7. d는 알고 있는 내용을 증언함으로써 b에게 응답한다.

## 2. 책임

객체지향의 세계에서는 어떤 객체가 어떤 요청에 대해 대답해 줄 수 있거나, 적절한 행동을 할 의무가 있는경우 해당 객체가 **책임**을 가진다고 말한다.

**책임의 분류**

- **하는 것(doing)**
    - 객체를 생성하거나 계산을 하는 등의 스스로 하는 것
    - 다른 객체의 행동을 시작시키는 것
    - 다른 객체의 활동을 제어하고 조절하는 것
- **아는 것(knowing)**
    - 개인적인 정보에 관해 아는 것
    - 관련된 객체에 관해 아는 것
    - 자신이 유도하거나 계산할 수 있는 것에 관해 아는 것

**책임**은 객체가 외부에 제공할 수 있는 **정보(아는 것)** 와 **서비스(하는 것)** 의 목록이다. 따라서 책임은 객체의 **공용 인터페이스(public interface)** 이다. 

객체가 다른 객체에게 요청을 보내는 것을 **메시지 전송(message-send)** 이라고 한다. 요청하는 객체를 **송신자**라고 하고 요청을 처리하는 객체를 **수신자**라고 한다. 따라서 **두 객체 간의 협력**은 메시지를 통해서 이뤄진다.

한가지 주의 해야 할 점은 **책임과 메시지의 수준이 같지 않다는 점**이다. 책임을 결정한 후 실제로 협력을 정제하면서 이를 메시지로 변환할 때는 하나의 책임이 여러 메시지로 분할 되는 것이 일반적이다.

객체지향 설계에서 항상 **협력**을 위한 **책임**과 **메시지**에 대한 전체적인 윤곽을 잡은 후에 다음 단계로 넘어가야 한다. 

## 3. 역할

**역할이란 책임의 집합이다.**

재판관의 역할을 왕 대신 왕비가 수행하고 증인의 역할을 모자 장수 대신 앨리스가 수행한다고 해서 협력을 일일이 수정해야 할까??

아니다!!! 다시 한번 **추상화**라는 마법을 부려 복잡한 현실을 간단하게 만들면 된다. 협력에 왕의 이름 대신 판사라는 역할을 모자 장수 대신 증인이라는 역할을 넣으면 간단하다.

결과적으로 역할의 개념을 사용하면 유사한 협력을 추상화해서 인지 과부하를 줄일 수 있다. 또한 다양한 객체들이 협력에 참여할 수 있기에 협력이 좀 더 유연해지며 재사용성이 높아진다. 그리고 역할은 객체지향 설계의 단순성(simplicity), 유연성(flexibility), 재사용성(reusability)을 뒷받침한다.

- 객체가 역할을 수행할 수 있다는 의미는 **주어진 책임**(메시지를 수신하여 처리하는)을 문제없이 할 수 있다는 의미이다.**(행위 호환성)**
- **하나의 객체가** 주어진 책임을 수행할 수 있다면 **동시에 여러개의 역할을 수행**할 수 있다는 의미이기도 하다. ex. 왕은 재판관의 역할과 왕의 역할을 동시에 수행 가능하다.
- 역할을 수행할 수 있는 객체들은 서로가 **대체 가능**하다는 의미를 가진다.

따라서 대부분의 경우에 객체의 타입과 역할 사이에는 **일반화/특수화 관계**가 성립하는 것이 일반적이다.

## 4. 객체의 모양을 결정하는 협력

**올바른 객체지향 설계순서**

1. **견고하고 깔끔한 협력 설계**: 객체들이 주고받을 요청과 응답의 흐름을 결정한다. 
2. 위 흐름에 따라 객체가 협력에 참여하기 위해 수행될 **책임(행동) 결정**
3. 행동에 필요한 **데이터 결정**
4. **클래스**의 구현 방법 결정

요약: 충분히 자율적인 동시에 충분히 협력적인 객체를 만드는 가장 쉬운 방법은 객체를 충분히 협력적으로 만든 후에 협력이라는 문맥안에서 객체를 충분히 자율적으로 만드는 것이다.

## 5. 객체지향 설계 기법

아래 3가지는 앞으로 자세히 공부해야 한다!!!

1. **책임-주도 설계(Responsibility-Driven Design)** 방법은 협력에 필요한 책임들을 식별하고 적합한 객체에게 책임을 할당하는 방식으로 애플리케이션을 설계한다.
2. **디자인 패턴(Design Pattern)** 은 전문가들이 반복적으로 사용하는 해결 방법을 정의해 놓은 설계 템플릿의 모음.
3. **테스트-주도 개발(Test-Driven Development)** 은 테스트를 먼저 작성하고 테스트를 통과하는 구체적인 코드를 추가하면서 애플리케이션을 완성해가는 방식. 테스트가 아닌 설계를 위한 기법
